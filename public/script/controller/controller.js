// Generated by CoffeeScript 1.10.0
app.controller('bannerCrtl', [
  '$scope', '$location', '$timeout', function(scope, location, timeout) {
    $('.fancybox').fancybox();
    $('.fancybox2').fancybox();
    scope.verMenu = function(e) {
      $("#navMovil").toggle("slow");
    };
    scope.mostrarPopup = function() {
      $("#suscribete").fadeIn("slow");
    };
    scope.ocultarPopup = function() {
      $("#suscribete").fadeOut("slow");
    };
  }
]);

app.controller('desplegarCrtl', [
  '$scope', '$location', '$timeout', function(scope, location, timeout) {
    scope.desplegarTexto = function() {
      if ($(".filtros").hasClass("cerrar") === false) {
        $(".filtros").addClass("cerrar");
        $(".inner-energia .filtros").fadeOut("slow");
        $("#texto").css("width", "100%");
        return setTimeout(function() {
          $(".desplegar figure").addClass("form-error");
          return $(".abrir figure").removeClass("form-error");
        }, 500);
      } else {
        $(".filtros").removeClass("cerrar");
        $(".inner-energia .filtros").fadeIn("slow");
        $("#texto").css("width", "50%");
        return $(".desplegar figure").toggleClass("form-error");
      }
    };
  }
]);

app.controller('biblioArtiCrtl', [
  '$scope', '$http', '$timeout', '$location', function(scope, http, timeout, location2) {
    scope.arranio = [];
    scope.arranio = {};
    scope.arrmes = [];
    scope.arrmes = {};
    scope.datos = [];
    scope.datos = {};
    scope.arrpubli = [];
    scope.arrpubli = {};
    scope.arrpubli = [
      {
        id: 1,
        name: "Todos"
      }, {
        id: 2,
        name: "Boletines"
      }, {
        id: 3,
        name: "Transacciones"
      }, {
        id: 4,
        name: "Artículos"
      }, {
        id: 5,
        name: "Noticias"
      }
    ];
    scope.selectedAnio = [];
    scope.selectedMes = [];
    scope.numpage = 1;
    scope.pageactive = 1;
    scope.totalpage = 0;
    scope.filtro = "";
    scope.range = [];
    scope.selectedPubli = scope.arrpubli[0];
    scope.formData = new FormData();
    scope.url = "../controller/edificio/procesar.php";
    scope.selectedArea = 0;
    scope.numpage = 0;
    scope.limpiarCombos = function() {
      scope.arranio = [
        {
          id: 0,
          name: "--"
        }
      ];
      scope.selectedAnio = scope.arranio[0];
      scope.arrmes = [
        {
          id: 0,
          name: "--"
        }
      ];
      scope.selectedMes = scope.arrmes[0];
    };
    scope.cargarAnio = function() {
      var data, result, url;
      scope.limpiarCombos();
      if ((scope.selectedArea != null) && scope.selectedArea !== 0) {
        url = 'controller/biblioteca/anio.php';
        scope.idArea = scope.selectedArea;
        data = {
          id: scope.idArea
        };
        result = http.post(url, data);
        result.then(function(response) {
          console.log(response);
          if (response.data.arr !== "") {
            scope.arranio = response.data.arr;
            scope.selectedAnio = scope.arranio[0];
          }
        });
      } else {
        scope.limpiarCombos();
      }
    };
    scope.cargarMes = function() {
      var data, result, url;
      console.log(scope.selectedAnio);
      if ((scope.selectedAnio != null) && (scope.selectedAnio.id != null)) {
        url = 'controller/biblioteca/mes.php';
        data = {
          id: scope.selectedAnio.id,
          idArea: scope.selectedArea
        };
        result = http.post(url, data);
        result.then(function(response) {
          scope.arrmes = response.data.arr;
          scope.selectedMes = scope.arrmes[0];
        });
      } else {
        scope.arrmes = {};
      }
    };
    scope.listarDocumento = function(page, filtro) {
      var data, result, url;
      data = {
        page: page,
        filtro: filtro
      };
      console.log(data);
      url = 'controller/biblioteca/listar2.php';
      result = http.post(url, data);
      result.then(function(response) {
        var i, results;
        console.log(response);
        if (response.data.documentos.html !== "") {
          scope.datos = response.data.documentos.html;
          i = 0;
          scope.totalpage = response.data.paginado.total_paginas;
          console.log(scope.totalpage);
          if (scope.totalpage !== 0) {
            if (scope.totalpage === 1) {
              scope.range.push(0);
              return i++;
            } else {
              results = [];
              while (i < scope.totalpage) {
                scope.range.push(i);
                results.push(i++);
              }
              return results;
            }
          }
        } else {
          return scope.datos = "<div class='msjeAlert'><p>No se han encontrado archivos</p></div>";
        }
      });
    };
    scope.buscarRevista = function() {
      var idAnio, idArea, idMes, idTipo;
      scope.range = [];
      idArea = scope.selectedArea;
      idAnio = scope.selectedAnio.id;
      idMes = scope.selectedMes.id;
      idTipo = scope.selectedPubli.id;
      scope.filtro = idArea + "@" + idAnio + "@" + idMes + "@" + idTipo;
      scope.listarDocumento(scope.numpage, scope.filtro);
      console.log(idArea);
      console.log(idAnio);
      console.log(idMes);
      console.log(idTipo);
    };
    scope.activePage = function(page) {
      if (page === scope.pageactive) {
        return "active";
      } else {
        return "";
      }
    };
    scope.paginar = function(page) {
      scope.range = [];
      scope.pageactive = page;
      scope.listarDocumento(page, scope.filtro);
    };
    scope.getGet = function() {
      var GET, codigo, getString, loc;
      loc = document.location.href;
      if (loc.indexOf('?') > 0) {
        getString = loc.split('?')[1];
        GET = getString.split('&');
        codigo = GET[0].split('=');

        /*
        			get = {}
        			i = 0
        			l = scope.GET.lenght
        			console.log l
        			while i < l
        				tmp = scope.GET[i].split('=')
        				get[tmp[0]] = unescape(decodeURI(tmp[1]))
        				i++
         */
        return codigo[1];
      }
    };
    scope.cargarInfoArea = function(id) {
      console.log(id);
      scope.filtro = id;
      scope.cargarAnio();
      scope.listarDocumento(scope.numpage, scope.filtro);
    };
    scope.selectedArea = scope.getGet();
    scope.cargarInfoArea(scope.selectedArea);
  }
]);

app.controller('bibliotecaCrtl', [
  '$scope', '$http', '$timeout', '$location', function(scope, http, timeout, location2) {
    scope.arrarea = [];
    scope.arrarea = {};
    scope.arranio = [];
    scope.arranio = {};
    scope.arrmes = [];
    scope.arrmes = {};
    scope.datos = [];
    scope.datos = {};
    scope.arrpubli = [];
    scope.arrpubli = {};
    scope.arrpubli = [
      {
        id: 1,
        name: "Todos"
      }, {
        id: 2,
        name: "Boletines"
      }, {
        id: 3,
        name: "Transacciones"
      }, {
        id: 4,
        name: "Artículos"
      }, {
        id: 5,
        name: "Noticias"
      }
    ];
    scope.selectedArea = [];
    scope.nameArea = "";
    scope.selectedAnio = [];
    scope.selectedMes = [];
    scope.numpage = 1;
    scope.pageactive = 1;
    scope.totalpage = 0;
    scope.filtro = "";
    scope.range = [];
    scope.selectedPubli = scope.arrpubli[0];
    scope.formData = new FormData();
    scope.url = "../controller/edificio/procesar.php";
    scope.ocultarmensaje = function() {
      $("#new_post .msje").fadeOut('slow');
      if ($("#new_post .msje .alert").hasClass('alert-success')) {
        $("#new_post .msje .alert").removeClass('alert-success');
      }
      if ($("#new_post .msje .alert").hasClass('alert-danger')) {
        $("#new_post .msje .alert").removeClass('alert-danger');
      }
    };
    scope.limpiarCombos = function() {
      scope.arranio = [
        {
          id: 0,
          name: "--"
        }
      ];
      scope.selectedAnio = scope.arranio[0];
      scope.arrmes = [
        {
          id: 0,
          name: "--"
        }
      ];
      scope.selectedMes = scope.arrmes[0];
    };
    scope.cargarArea = function() {
      var result, url;
      scope.limpiarCombos();
      url = 'controller/biblioteca/area.php';
      result = http.post(url);
      result.then(function(response) {
        if (response.data.arr !== "") {
          scope.arrarea = response.data.arr;
          scope.selectedArea = scope.arrarea[0];
        }
      });
    };
    scope.cargarAnio = function() {
      var data, result, url;
      scope.limpiarCombos();
      if ((scope.selectedArea != null) && (scope.selectedArea.id != null) && scope.selectedArea.id !== 0) {
        url = 'controller/biblioteca/anio.php';
        scope.idArea = scope.selectedArea.id;
        data = {
          id: scope.idArea
        };
        result = http.post(url, data);
        result.then(function(response) {
          if (response.data.arr !== "") {
            scope.arranio = response.data.arr;
            scope.selectedAnio = scope.arranio[0];
          }
        });
      } else {
        scope.limpiarCombos();
      }
    };
    scope.cargarMes = function() {
      var data, result, url;
      if ((scope.selectedAnio != null) && (scope.selectedAnio.id != null)) {
        url = 'controller/biblioteca/mes.php';
        data = {
          id: scope.selectedAnio.id,
          idArea: scope.selectedArea.id
        };
        result = http.post(url, data);
        result.then(function(response) {
          scope.arrmes = response.data.arr;
          scope.selectedMes = scope.arrmes[0];
        });
      } else {
        scope.arrmes = {};
      }
    };
    scope.listarDocumento = function(page, filtro) {
      var data, result, url;
      data = {
        page: page,
        filtro: filtro
      };
      url = 'controller/biblioteca/listar.php';
      result = http.post(url, data);
      result.then(function(response) {
        var i, results;
        console.log(response);
        if (response.data.documentos.html !== "") {
          scope.datos = response.data.documentos.html;
          i = 0;
          scope.totalpage = response.data.paginado.total_paginas;
          console.log(scope.totalpage);
          if (scope.totalpage !== 0) {
            if (scope.totalpage === 1) {
              scope.range.push(0);
              return i++;
            } else {
              results = [];
              while (i < scope.totalpage) {
                scope.range.push(i);
                results.push(i++);
              }
              return results;
            }
          }
        } else {
          return scope.datos = "<div class='msjeAlert'><p>El área <span>" + scope.nameArea + "</span> no contiene archivos</p></div>";
        }
      });
    };
    scope.buscarRevista = function() {
      var idAnio, idArea, idMes, idTipo;
      scope.range = [];
      idArea = scope.selectedArea.id;
      scope.nameArea = scope.selectedArea.name;
      console.log(scope.nameArea);
      idAnio = scope.selectedAnio.id;
      idMes = scope.selectedMes.id;
      idTipo = scope.selectedPubli.id;
      scope.filtro = idArea + "@" + idAnio + "@" + idMes + "@" + idTipo;
      scope.listarDocumento(scope.numpage, scope.filtro);
      console.log(idArea);
      console.log(idAnio);
      console.log(idMes);
      console.log(idTipo);
    };
    scope.activePage = function(page) {
      if (page === scope.pageactive) {
        return "active";
      } else {
        return "";
      }
    };
    scope.paginar = function(page) {
      scope.range = [];
      scope.pageactive = page;
      scope.listarDocumento(page, '');
    };
    scope.cargarArea();
    scope.listarDocumento(scope.numpage, '');
  }
]);
